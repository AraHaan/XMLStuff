name: .NET Core

on: [push]

jobs:
  build:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v1
    - name: .NET Core setup
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: 3.0.100
    - uses: warrenbuckley/Setup-Nuget@v1
    - name: .NET Core pre-build
      run: >-
        nuget install OpenCover -Version 4.7.922 -OutputDirectory packages
        
        nuget install Codecov -Version 1.9.0 -OutputDirectory packages
        
    - name: .NET Core build
      run: dotnet build src/XmlAbstraction/XmlAbstraction.sln --configuration Release
    - name: .NET Core test
      run: >-
        cd src/XmlAbstraction/
        
        dotnet test test\ /p:CollectCoverage=true /p:CoverletOutputFormat=opencover
        
        cd ../../
        
        packages\Codecov.1.9.0\tools\codecov.exe -t "c42c5efb-e57d-4644-a35f-1013bcfaee8f" -f "src/XmlAbstraction/test/coverage.opencover.xml"
        
    # experiment with uploading the *.nupkgs.
    - name: Upload the artifacts
      uses: skx/github-action-publish-binaries@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        args: 'src/XmlAbstraction/src/bin/Any CPU/Release/XmlAbstraction.*.nupkg'
        
